<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="robots" content="noindex, nofollow">
    <script>
        (function () {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('key') !== 'syakyo2025') {
                document.write('<div style="padding:20px;font-family:sans-serif;"><h2>ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã‚ã‚Šã¾ã›ã‚“</h2><p>å°‚ç”¨ã®URLï¼ˆåˆè¨€è‘‰ä»˜ãï¼‰ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ãã ã•ã„ã€‚</p></div>');
                document.close();
                window.stop();
            }
        })();
    </script>

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå ±å‘Šã‚¢ãƒ—ãƒªï¼ˆãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹ç‰ˆï¼‰</title>
    <style>
        /* --------------------------------------------------
     CSS: ãƒ‡ã‚¶ã‚¤ãƒ³è¨­å®š
  -------------------------------------------------- */
        body {
            font-family: "Helvetica Neue", Arial, sans-serif;
            background: #f4f7f6;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        /* ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ */
        .tab-menu {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 12px 24px;
            margin: 5px;
            cursor: pointer;
            border: none;
            background: #e0e0e0;
            font-size: 16px;
            border-radius: 30px;
            transition: all 0.3s;
            font-weight: bold;
            color: #555;
        }

        .tab-btn.active {
            background: #007bff;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 123, 255, 0.3);
        }

        .tab-btn:hover:not(.active) {
            background-color: #d0d0d0;
        }

        /* ç”»é¢ã‚³ãƒ³ãƒ†ãƒŠ */
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 12px;
            display: none;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.05);
        }

        .container.active {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h2 {
            text-align: center;
            color: #007bff;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        /* å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  */
        .input-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 8px;
            color: #444;
        }

        /* å¿…é ˆãƒãƒ¼ã‚¯ */
        .required {
            color: red;
            margin-left: 3px;
        }

        input[type="text"],
        input[type="date"],
        input[type="datetime-local"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: #007bff;
            outline: none;
        }

        textarea {
            height: 100px;
            resize: vertical;
        }

        /* ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .checkbox-container {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 10px;
            max-height: 300px;
            overflow-y: auto;
            background: #fff;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            cursor: pointer;
            flex-wrap: wrap;
            /* ã‚¹ãƒãƒ›å¯¾å¿œ */
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 8px;
            transform: scale(1.2);
        }

        /* ãã®ä»–ã®å…¥åŠ›æ¬„ */
        .other-input {
            margin-left: 10px;
            padding: 5px;
            width: 200px;
            font-size: 14px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* Polishing Area */
        .polish-source {
            background-color: #f9f9f9;
            padding: 10px;
            border-left: 4px solid #ccc;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
        }

        /* ãƒœã‚¿ãƒ³å…±é€šã‚¹ã‚¿ã‚¤ãƒ« */
        .action-btn {
            display: block;
            width: 100%;
            text-decoration: none;
            text-align: center;
            background-color: #28a745;
            color: white;
            border: none;
            padding: 15px;
            font-size: 18px;
            cursor: pointer;
            border-radius: 6px;
            font-weight: bold;
            margin-top: 20px;
            transition: background-color 0.3s;
            box-shadow: 0 4px 6px rgba(40, 167, 69, 0.2);
        }

        .action-btn:hover {
            background-color: #218838;
        }

        .nav-btns {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .nav-btn {
            flex: 1;
            padding: 15px;
            border-radius: 6px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
            color: white;
        }

        .btn-next {
            background-color: #007bff;
        }

        .btn-next:hover {
            background-color: #0069d9;
        }

        .btn-back {
            background-color: #6c757d;
        }

        .btn-back:hover {
            background-color: #5a6268;
        }

        /* çµ±è¨ˆã‚¿ãƒ– */
        .stats-info {
            text-align: center;
            padding: 40px 20px;
            color: #555;
        }

        /* --------------------------------------------------
     CSS: å°åˆ·ç”¨è¨­å®š
  -------------------------------------------------- */
        .print-sheet {
            display: none;
        }

        @media print {

            body {
                background: white;
                margin: 0;
                padding: 0;
            }

            .tab-menu,
            .container {
                display: none !important;
            }

            .print-sheet {
                display: block !important;
                width: 100%;
                padding: 10mm;
                box-sizing: border-box;
                font-size: 11pt;
                font-family: "Mincho", serif;
            }

            h1.report-title {
                text-align: center;
                border-bottom: 2px solid #000;
                margin-bottom: 15px;
                font-size: 18pt;
            }

            table.report-table {
                width: 100%;
                border-collapse: collapse;
                margin-bottom: 10px;
            }

            table.report-table th,
            table.report-table td {
                border: 1px solid #000;
                padding: 6px 8px;
                vertical-align: top;
            }

            table.report-table th {
                background-color: #f0f0f0 !important;
                width: 20%;
                text-align: left;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                font-weight: bold;
            }

            .section-header {
                background-color: #ddd !important;
                text-align: center;
                font-weight: bold;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
                padding: 4px;
                border: 1px solid #000;
                margin-top: 10px;
                border-bottom: none;
            }

            .footer-sign {
                margin-top: 20px;
                display: flex;
                justify-content: flex-end;
                gap: 20px;
            }

            .sign-box {
                border: 1px solid #000;
                width: 80px;
                height: 80px;
                display: flex;
                flex-direction: column;
                padding: 5px;
                font-size: 0.8em;
            }

            table {
                page-break-inside: avoid;
            }
        }

        /* ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.8);
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            color: #555;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid #007bff;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>

    <!-- ã‚¿ãƒ–ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div class="tab-menu">
        <button class="tab-btn active" onclick="switchTab('input')">1. å ±å‘Šå…¥åŠ›</button>
        <button class="tab-btn" onclick="switchTab('review')">2. ã”ç¢ºèªãƒ»æ·»å‰Š</button>
        <button class="tab-btn" onclick="switchTab('stats')">3. çµ±è¨ˆãƒ‡ãƒ¼ã‚¿</button>
    </div>

    <!-- ã€ç”»é¢1ã€‘å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div id="tab-input" class="container active">
        <h2>ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå ±å‘Š (å…¥åŠ›)</h2>
        <form id="inputForm">

            <!-- åŸºæœ¬æƒ…å ± -->
            <div class="input-group">
                <label>å ±å‘Šæ—¥ <span class="required">*</span></label>
                <input type="date" id="in-report-date">
            </div>
            <div class="input-group">
                <label>ç™ºç”Ÿæ—¥æ™‚ <span class="required">*</span></label>
                <input type="datetime-local" id="in-occurrence-date">
            </div>
            <div class="input-group">
                <label>å ±å‘Šè€…æ°å <span class="required">*</span></label>
                <input type="text" id="in-reporter" placeholder="å±±ç”° å¤ªéƒ">
            </div>

            <!-- ç™ºç”Ÿå ´æ‰€ (è¨˜è¿°å¼) -->
            <div class="input-group">
                <label>ç™ºç”Ÿå ´æ‰€</label>
                <textarea id="in-place" placeholder="è©³ç´°ãªå ´æ‰€ã‚’è¨˜å…¥ã—ã¦ãã ã•ã„" style="height: 60px;"></textarea>
            </div>

            <!-- å¯¾è±¡è€… -->
            <div class="input-group">
                <label>åˆ©ç”¨è€…ID (ä»»æ„)</label>
                <input type="text" id="in-userid" placeholder="12345">
            </div>

            <!-- æ¦‚è¦ãƒ»è©³ç´° -->
            <div class="input-group">
                <label>äº‹è±¡ã®æ¦‚è¦ (ã‚¿ã‚¤ãƒˆãƒ«)</label>
                <input type="text" id="in-overview" placeholder="ä¾‹ï¼šé€è¿è»Šä¹—è»Šæ™‚ã®ãµã‚‰ã¤ã">
            </div>
            <div class="input-group">
                <label>çŠ¶æ³èª¬æ˜ (è©³ç´°) <span class="required">*</span></label>
                <textarea id="in-situation" placeholder="ã„ã¤ã€ã©ã“ã§ã€èª°ãŒã€ã©ã†ã—ãŸ..."></textarea>
            </div>

            <!-- åˆ†é¡ (è¤‡æ•°é¸æŠå¯) -->
            <div class="input-group">
                <label>äº‹è±¡ã®ç¨®é¡ (è¤‡æ•°é¸æŠå¯)</label>
                <div class="checkbox-container" id="in-type-group">
                    <label class="checkbox-item"><input type="checkbox" name="type" value="é€è¿ã®ãƒˆãƒ©ãƒ–ãƒ«"> é€è¿ã®ãƒˆãƒ©ãƒ–ãƒ«</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="è»¢å€’ãƒ»è»¢è½"> è»¢å€’ãƒ»è»¢è½</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="èª¤è–¬"> èª¤è–¬</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="é£Ÿäº‹ä»‹åŠ©ãƒŸã‚¹"> é£Ÿäº‹ä»‹åŠ©ãƒŸã‚¹</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã®äº‹æ•…">
                        ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ä¸­ã®äº‹æ•…</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="æ’æ³„ä»‹åŠ©ãƒŸã‚¹"> æ’æ³„ä»‹åŠ©ãƒŸã‚¹</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="å…¥æµ´ä»‹åŠ©ãƒŸã‚¹"> å…¥æµ´ä»‹åŠ©ãƒŸã‚¹</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="æ„ŸæŸ“å¯¾ç­–ä¸å‚™"> æ„ŸæŸ“å¯¾ç­–ä¸å‚™</label>
                    <label class="checkbox-item"><input type="checkbox" name="type" value="ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¶³">
                        ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ä¸è¶³</label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="type" value="ãã®ä»–"> ãã®ä»–:
                        <input type="text" class="other-input" placeholder="è©³ç´°">
                    </label>
                </div>
            </div>

            <!-- èƒŒæ™¯è¦å›  (è¤‡æ•°é¸æŠå¯) -->
            <div class="input-group">
                <label>èƒŒæ™¯è¦å›  (è¤‡æ•°é¸æŠå¯)</label>
                <div class="checkbox-container" id="in-background-group">
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="äººçš„ï¼šä¸æ³¨æ„ãƒ»ç¢ºèªä¸è¶³">
                        äººçš„ï¼šä¸æ³¨æ„ãƒ»ç¢ºèªä¸è¶³</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="äººçš„ï¼šæ•™è‚²ãƒ»ç¢ºèªä¸è¶³"> äººçš„ï¼šæ•™è‚²ãƒ»ç¢ºèªä¸è¶³</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="ç’°å¢ƒï¼šç…§æ˜ä¸è¶³ãƒ»åºŠã®æ»‘ã‚Šãƒ»æ®µå·®">
                        ç’°å¢ƒï¼šç…§æ˜ä¸è¶³ãƒ»åºŠã®æ»‘ã‚Šãƒ»æ®µå·®</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="ç’°å¢ƒï¼šé¨’éŸ³ãƒ»æ··é›‘ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ä¸è¶³">
                        ç’°å¢ƒï¼šé¨’éŸ³ãƒ»æ··é›‘ãƒ»ã‚¹ãƒšãƒ¼ã‚¹ä¸è¶³</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="æ‰‹é †ï¼šãƒãƒ‹ãƒ¥ã‚¢ãƒ«æœªéµå®ˆãƒ»çœç•¥">
                        æ‰‹é †ï¼šãƒãƒ‹ãƒ¥ã‚¢ãƒ«æœªéµå®ˆãƒ»çœç•¥</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="ç®¡ç†ï¼šäººå“¡ä¸è¶³ãƒ»éå¯†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«">
                        ç®¡ç†ï¼šäººå“¡ä¸è¶³ãƒ»éå¯†ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="åˆ©ç”¨è€…ï¼šèªçŸ¥ç—‡ãƒ»ã›ã‚“å¦„ãƒ»å”åŠ›å›°é›£">
                        åˆ©ç”¨è€…ï¼šèªçŸ¥ç—‡ãƒ»ã›ã‚“å¦„ãƒ»å”åŠ›å›°é›£</label>
                    <label class="checkbox-item"><input type="checkbox" name="bg" value="åˆ©ç”¨è€…ï¼šèº«ä½“çš„æ©Ÿèƒ½ä½ä¸‹ãƒ»æ€¥å¤‰">
                        åˆ©ç”¨è€…ï¼šèº«ä½“çš„æ©Ÿèƒ½ä½ä¸‹ãƒ»æ€¥å¤‰</label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="bg" value="ãã®ä»–"> ãã®ä»–:
                        <input type="text" class="other-input" placeholder="è©³ç´°">
                    </label>
                </div>
            </div>

            <!-- ãƒªã‚¹ã‚¯è©•ä¾¡ (å˜ä¸€é¸æŠ) -->
            <div class="input-group">
                <label>æ½œåœ¨çš„ãªå±é™ºåº¦</label>
                <select id="in-risk-level">
                    <option value="1">1 (ä½)</option>
                    <option value="2">2ï¼ˆä¸­ï¼‰</option>
                    <option value="3">3ï¼ˆé«˜ï¼‰</option>
                    <option value="4">4 (è‡´å‘½çš„)</option>
                </select>
            </div>
            <div class="input-group">
                <label>ç™ºç”Ÿé »åº¦</label>
                <select id="in-frequency">
                    <option value="1">1 (ã¾ã‚Œ)</option>
                    <option value="2">2</option>
                    <option value="3">3ï¼ˆé »ç¹ï¼‰</option>
                    <option value="4">4 (æ¥µã‚ã¦é »ç¹)</option>
                </select>
            </div>

            <!-- å¯¾ç­– (è¤‡æ•°é¸æŠå¯) -->
            <div class="input-group">
                <label>ç›´å¾Œã®å¯¾å¿œ (è¤‡æ•°é¸æŠå¯)</label>
                <div class="checkbox-container" id="in-response-group">
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="åˆ©ç”¨è€…ã®å®‰å…¨ç¢ºä¿"> åˆ©ç”¨è€…ã®å®‰å…¨ç¢ºä¿</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="ãƒã‚¤ã‚¿ãƒ«ç¢ºèªãƒ»çŠ¶æ…‹è¦³å¯Ÿ">
                        ãƒã‚¤ã‚¿ãƒ«ç¢ºèªãƒ»çŠ¶æ…‹è¦³å¯Ÿ</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="çœ‹è­·å¸«ãƒ»ä¸Šé•·ã¸ã®å ±å‘Š">
                        çœ‹è­·å¸«ãƒ»ä¸Šé•·ã¸ã®å ±å‘Š</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="åŒ»å¸«ã¸ã®é€£çµ¡ãƒ»æŒ‡ç¤ºå—ã‘">
                        åŒ»å¸«ã¸ã®é€£çµ¡ãƒ»æŒ‡ç¤ºå—ã‘</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="è–¬å‰¤ãƒ»é£Ÿäº‹ã®å†ç¢ºèªãƒ»ä¸­æ­¢">
                        è–¬å‰¤ãƒ»é£Ÿäº‹ã®å†ç¢ºèªãƒ»ä¸­æ­¢</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="æ©Ÿå™¨ã®ç‚¹æ¤œãƒ»ä½¿ç”¨åœæ­¢">
                        æ©Ÿå™¨ã®ç‚¹æ¤œãƒ»ä½¿ç”¨åœæ­¢</label>
                    <label class="checkbox-item"><input type="checkbox" name="resp" value="ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå…±æœ‰"> ã‚¤ãƒ³ã‚·ãƒ‡ãƒ³ãƒˆå…±æœ‰</label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="resp" value="ãã®ä»–"> ãã®ä»–:
                        <input type="text" class="other-input" placeholder="è©³ç´°">
                    </label>
                </div>
            </div>

            <div class="input-group">
                <label>å†ç™ºé˜²æ­¢ç­– (è¤‡æ•°é¸æŠå¯)</label>
                <div class="checkbox-container" id="in-prevention-group">
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="é€è¿æ™‚ã®å®‰å…¨ç¢ºèªå¼·åŒ–">
                        é€è¿æ™‚ã®å®‰å…¨ç¢ºèªå¼·åŒ–</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="å£°æ›ã‘ãƒ»ç¢ºèªã®å¾¹åº•"> å£°æ›ã‘ãƒ»ç¢ºèªã®å¾¹åº•</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯å°å…¥"> ãƒ€ãƒ–ãƒ«ãƒã‚§ãƒƒã‚¯å°å…¥</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ä»‹åŠ©æ‰‹é †ã®è¦‹ç›´ã—ãƒ»æ¨™æº–åŒ–">
                        ä»‹åŠ©æ‰‹é †ã®è¦‹ç›´ã—ãƒ»æ¨™æº–åŒ–</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ç¦ç¥‰ç”¨å…·ã®ç‚¹æ¤œãƒ»è¨­å‚™å¼·åŒ–">
                        ç¦ç¥‰ç”¨å…·ã®ç‚¹æ¤œãƒ»è¨­å‚™å¼·åŒ–</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ç’°å¢ƒè¨­å‚™"> ç’°å¢ƒè¨­å‚™</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="æ•™è‚²ãƒ»ç ”ä¿®"> æ•™è‚²ãƒ»ç ”ä¿®</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–">
                        ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å®‰å…¨å¯¾ç­–">
                        ãƒ¬ã‚¯ãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³å®‰å…¨å¯¾ç­–</label>
                    <label class="checkbox-item"><input type="checkbox" name="prev" value="ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå…±æœ‰ä¼šãƒ»æŒ¯ã‚Šè¿”ã‚Š">
                        ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå…±æœ‰ä¼šãƒ»æŒ¯ã‚Šè¿”ã‚Š</label>
                    <label class="checkbox-item">
                        <input type="checkbox" name="prev" value="ãã®ä»–"> ãã®ä»–:
                        <input type="text" class="other-input" placeholder="è©³ç´°">
                    </label>
                </div>
            </div>

            <!-- ãã®ä»– -->
            <div class="input-group">
                <label>è©³ç´°ãªåŸå› åˆ†æãƒ»è£œè¶³ (ä»»æ„)</label>
                <textarea id="in-detailed-cause" placeholder="è£œè¶³ãŒã‚ã‚Œã°è¨˜å…¥"></textarea>
            </div>
            <div class="input-group">
                <label>è¿½åŠ ã®è¦³å¯Ÿãƒ»å¯¾å¿œå†…å®¹ (ä»»æ„)</label>
                <textarea id="in-additional-obs"></textarea>
            </div>
            <div class="input-group">
                <label>åˆ©ç”¨è€…ãƒ»å®¶æ—ã¸ã®èª¬æ˜ (è¨˜è¿°å¼) <span class="required">*</span></label>
                <textarea id="in-family-expl" placeholder="èª°ã«ã€ã„ã¤ã€ã©ã®ã‚ˆã†ã«èª¬æ˜ã—ãŸã‹ã€‚ã¾ãŸã¯ã€Œä¸è¦ã€ã®ç†ç”±ãªã©"
                    style="height: 60px;"></textarea>
            </div>
            <div class="input-group">
                <label>æ‹…å½“è€… (è¨˜å…¥è€…)</label>
                <input type="text" id="in-incharge">
            </div>

            <div class="nav-btns">
                <button type="button" class="nav-btn btn-next" onclick="goToReview()">æ¬¡ã¸ï¼šå†…å®¹ç¢ºèªãƒ»æ·»å‰Š</button>
            </div>
        </form>
    </div>

    <!-- ã€ç”»é¢2ã€‘ç¢ºèªãƒ»æ·»å‰Š -->
    <div id="tab-review" class="container">
        <h2>å†…å®¹ã®ã”ç¢ºèªãƒ»æ–‡ç« ã®èª¿æ•´ (æ·»å‰Š)</h2>
        <p style="background:#eef; padding:10px; border-radius:5px;">
            ğŸ’¡ <strong>å°åˆ·ãƒ»æå‡ºç”¨ã«æ–‡ç« ã‚’æ•´ãˆã¦ãã ã•ã„ã€‚</strong><br>
            ä¸‹ã®å…¥åŠ›æ¬„ï¼ˆç™½ã„ãƒœãƒƒã‚¯ã‚¹ï¼‰ã®å†…å®¹ãŒã€å°åˆ·ãŠã‚ˆã³Googleãƒ•ã‚©ãƒ¼ãƒ ã¸ã®é€ä¿¡ã«ä½¿ç”¨ã•ã‚Œã¾ã™ã€‚<br>
            AIè£œæ­£ã¯ã§ãã¾ã›ã‚“ãŒã€ã”è‡ªèº«ã§åˆ†ã‹ã‚Šã‚„ã™ã„è¡¨ç¾ã«æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚
        </p>

        <form id="submissionForm" onsubmit="submitToGoogleForm(event)">
            <!-- è¨˜è¿°é …ç›® -->

            <h3>çŠ¶æ³èª¬æ˜</h3>
            <div class="polish-source">å…ƒã®å…¥åŠ›: <span id="disp-situation"></span></div>
            <textarea id="polish-situation" class="polished-input"></textarea>

            <!-- é¸æŠé …ç›®ã®ç¢ºèª (æ·»å‰Šä¸å¯) -->
            <h3>é¸æŠãƒ»è¨˜è¿°é …ç›®ã®ç¢ºèª</h3>
            <div class="polish-source">
                <strong>ç™ºç”Ÿå ´æ‰€:</strong> <span id="disp-place"></span>
            </div>
            <div class="polish-source">
                <strong>äº‹è±¡ã®ç¨®é¡:</strong> <span id="disp-type"></span>
            </div>
            <div class="polish-source">
                <strong>èƒŒæ™¯è¦å› :</strong> <span id="disp-background"></span>
            </div>
            <div class="polish-source">
                <strong>ç›´å¾Œã®å¯¾å¿œ:</strong> <span id="disp-response"></span>
            </div>
            <div class="polish-source">
                <strong>å†ç™ºé˜²æ­¢ç­–:</strong> <span id="disp-prevention"></span>
            </div>
            <div class="polish-source">
                <strong>å®¶æ—èª¬æ˜:</strong> <span id="disp-family-expl"></span>
            </div>
            <p style="font-size:0.9em; color:#666; margin-bottom:20px;">â€»ä¸Šè¨˜é …ç›®ã‚’ä¿®æ­£ã™ã‚‹å ´åˆã¯ã€Œæˆ»ã‚‹ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚</p>

            <div class="nav-btns">
                <button type="button" class="nav-btn btn-back" onclick="switchTab('input')">æˆ»ã‚‹</button>
                <button type="submit" class="action-btn">
                    æ±ºå®šã—ã¦å°åˆ·ï¼†é€ä¿¡ã™ã‚‹
                </button>
            </div>
        </form>
    </div>

    <!-- ã€ç”»é¢3ã€‘çµ±è¨ˆãƒ‡ãƒ¼ã‚¿è¡¨ç¤º -->
    <div id="tab-stats" class="container">
        <h2>çµ±è¨ˆãƒ¬ãƒãƒ¼ãƒˆ</h2>

        <div class="stats-info">
            <p>çµ±è¨ˆã‚°ãƒ©ãƒ•ã¯Googleã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆ/ãƒ•ã‚©ãƒ¼ãƒ ã®æ©Ÿèƒ½ã§è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚</p>

            <!-- çµ±è¨ˆãƒšãƒ¼ã‚¸ã‚’é–‹ããƒœã‚¿ãƒ³ -->
            <a id="analytics-link" href="#" target="_blank" class="action-btn secondary-btn">çµ±è¨ˆã‚°ãƒ©ãƒ•ã‚’è¦‹ã‚‹ (Google)</a>
        </div>
    </div>

    <!-- ã€å°åˆ·ç”¨ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‘ -->
    <div class="print-sheet" id="print-area">
        <h1 class="report-title">ãƒ’ãƒ¤ãƒªãƒãƒƒãƒˆå ±å‘Šæ›¸ (ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹)</h1>

        <table class="report-table">
            <tr>
                <th>å ±å‘Šæ—¥</th>
                <td id="pr-report-date"></td>
                <th>ç™ºç”Ÿæ—¥æ™‚</th>
                <td id="pr-occurrence-date"></td>
            </tr>
            <tr>
                <th>å ±å‘Šè€…</th>
                <td id="pr-reporter"></td>
                <th>æ‹…å½“è€…</th>
                <td id="pr-incharge"></td>
            </tr>
            <tr>
                <th>ç™ºç”Ÿå ´æ‰€</th>
                <td id="pr-place" colspan="3" style="white-space: pre-wrap;"></td>
            </tr>
            <tr>
                <th>åˆ©ç”¨è€…ID</th>
                <td id="pr-userid"></td>
                <th>ç¨®é¡</th>
                <td id="pr-type"></td>
            </tr>
        </table>

        <div class="section-header">äº‹è±¡ã®è©³ç´°</div>
        <table class="report-table">
            <tr>
                <th>æ¦‚è¦</th>
                <td id="pr-overview" colspan="3"></td>
            </tr>
            <tr>
                <th style="height:100px;">çŠ¶æ³è©³ç´°</th>
                <td id="pr-situation" colspan="3" style="white-space: pre-wrap;"></td>
            </tr>
            <tr>
                <th>å±é™ºåº¦/é »åº¦</th>
                <td id="pr-risk-freq"></td>
                <th>èƒŒæ™¯è¦å› </th>
                <td id="pr-background"></td>
            </tr>
        </table>

        <div class="section-header">åˆ†æãƒ»å¯¾å¿œ</div>
        <table class="report-table">
            <tr>
                <th style="height:60px;">ç›´å¾Œã®å¯¾å¿œ</th>
                <td id="pr-response" colspan="3" style="white-space: pre-wrap;"></td>
            </tr>
            <tr>
                <th style="height:60px;">å†ç™ºé˜²æ­¢ç­–</th>
                <td id="pr-prevention" colspan="3" style="white-space: pre-wrap;"></td>
            </tr>
            <tr>
                <th>åˆ©ç”¨è€…ãƒ»<br>å®¶æ—ã¸ã®èª¬æ˜</th>
                <td id="pr-family-expl" colspan="3" style="white-space: pre-wrap;"></td>
            </tr>
            <tr>
                <th>è£œè¶³ãƒ»<br>è©³ç´°åˆ†æ</th>
                <td id="pr-detailed-cause" colspan="3"></td>
            </tr>
            <tr>
                <th>è¿½åŠ è¦³å¯Ÿ</th>
                <td id="pr-additional-obs" colspan="3"></td>
            </tr>
        </table>

        <div class="footer-sign">
            <div class="sign-box">æ–½è¨­é•·</div>
            <div class="sign-box">ç®¡ç†è€…</div>
            <div class="sign-box">ä¸Šé•·</div>
        </div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
    <div id="loading-overlay">
        <div class="spinner"></div>
        <div id="loading-message">é€ä¿¡ä¸­...</div>
    </div>

    <!-- é€ä¿¡ç”¨éš ã—iframe -->
    <iframe name="hidden_iframe" id="hidden_iframe" style="display:none;"></iframe>

    <script>
        // =========================================================
        // è¨­å®š
        // =========================================================

        const GOOGLE_FORM_ACTION_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc5UrkqyPX5T2AOvr5QkigprnENhDMuxYD0tRintMFzMl-B5Q/formResponse";
        const GOOGLE_ANALYTICS_URL = "https://docs.google.com/forms/d/e/1FAIpQLSc5UrkqyPX5T2AOvr5QkigprnENhDMuxYD0tRintMFzMl-B5Q/viewanalytics";

        const FIELD_MAP = {
            reportDate: "entry.588266897",
            occurrenceDate: "entry.1338291795",
            reporter: "entry.1897537616",
            place: "entry.838115658",
            userId: "entry.447475234",
            overview: "entry.1638599617",
            situation: "entry.174010907",
            type: "entry.1009107485",
            background: "entry.280429352",
            riskLevel: "entry.1349694909",
            frequency: "entry.1117417637",
            response: "entry.549134117",
            prevention: "entry.191456537",
            detailedCause: "entry.995379326",
            additionalObs: "entry.416335453",
            familyExpl: "entry.769419162",
            incharge: "entry.1697877680"
        };

        // =========================================================
        // ãƒ­ã‚¸ãƒƒã‚¯
        // =========================================================

        window.onload = function () {
            document.getElementById('analytics-link').href = GOOGLE_ANALYTICS_URL;
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('in-report-date').value = today;
        };

        function switchTab(tabName) {
            document.querySelectorAll('.container').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById('tab-' + tabName).classList.add('active');

            const btns = document.querySelectorAll('.tab-btn');
            for (let btn of btns) {
                if (btn.getAttribute('onclick').includes(tabName)) {
                    btn.classList.add('active');
                }
            }
            window.scrollTo(0, 0);
        }

        // ç”»é¢è¡¨ç¤ºç”¨ï¼šã‚«ãƒƒã‚³ä»˜ãã§è¡¨ç¤º
        function getCheckedValuesWithOther(containerId) {
            const container = document.getElementById(containerId);
            if (!container) return [];
            const checkboxes = container.querySelectorAll('input[type="checkbox"]');
            let results = [];

            checkboxes.forEach(cb => {
                if (cb.checked) {
                    if (cb.value === "ãã®ä»–") {
                        const otherText = cb.parentNode.querySelector('.other-input');
                        const textVal = otherText ? otherText.value.trim() : "";
                        if (textVal) {
                            results.push("ãã®ä»–(" + textVal + ")");
                        } else {
                            results.push("ãã®ä»–");
                        }
                    } else {
                        results.push(cb.value);
                    }
                }
            });
            return results;
        }

        window.onbeforeprint = function () {
            preparePrint();
        };

        function goToReview() {
            document.getElementById('disp-situation').innerText = document.getElementById('in-situation').value;
            document.getElementById('disp-place').innerText = document.getElementById('in-place').value;
            document.getElementById('disp-family-expl').innerText = document.getElementById('in-family-expl').value;

            document.getElementById('disp-type').innerText = getCheckedValuesWithOther('in-type-group').join(', ') || '(æœªé¸æŠ)';
            document.getElementById('disp-background').innerText = getCheckedValuesWithOther('in-background-group').join(', ') || '(æœªé¸æŠ)';
            document.getElementById('disp-response').innerText = getCheckedValuesWithOther('in-response-group').join(', ') || '(æœªé¸æŠ)';
            document.getElementById('disp-prevention').innerText = getCheckedValuesWithOther('in-prevention-group').join(', ') || '(æœªé¸æŠ)';

            const polSit = document.getElementById('polish-situation');
            if (!polSit.value) polSit.value = document.getElementById('in-situation').value;

            switchTab('review');
        }

        function preparePrint() {
            document.getElementById('pr-report-date').innerText = document.getElementById('in-report-date').value;
            const occDate = document.getElementById('in-occurrence-date').value;
            document.getElementById('pr-occurrence-date').innerText = occDate ? occDate.replace('T', ' ') : '';

            document.getElementById('pr-reporter').innerText = document.getElementById('in-reporter').value;
            document.getElementById('pr-incharge').innerText = document.getElementById('in-incharge').value;

            document.getElementById('pr-place').innerText = document.getElementById('in-place').value;
            document.getElementById('pr-userid').innerText = document.getElementById('in-userid').value;
            document.getElementById('pr-family-expl').innerText = document.getElementById('in-family-expl').value;

            document.getElementById('pr-overview').innerText = document.getElementById('in-overview').value;
            document.getElementById('pr-type').innerText = getCheckedValuesWithOther('in-type-group').join(', ');

            document.getElementById('pr-situation').innerText = document.getElementById('polish-situation').value || document.getElementById('in-situation').value;

            document.getElementById('pr-response').innerText = getCheckedValuesWithOther('in-response-group').join(', ');
            document.getElementById('pr-prevention').innerText = getCheckedValuesWithOther('in-prevention-group').join(', ');

            document.getElementById('pr-risk-freq').innerText =
                (document.getElementById('in-risk-level').value || '-') + " / " + (document.getElementById('in-frequency').value || '-');

            document.getElementById('pr-background').innerText = getCheckedValuesWithOther('in-background-group').join(', ');
            document.getElementById('pr-detailed-cause').innerText = document.getElementById('in-detailed-cause').value;
            document.getElementById('pr-additional-obs').innerText = document.getElementById('in-additional-obs').value;
        }

        var submitted = false;
        function submitToGoogleForm(e) {
            e.preventDefault();

            // 1. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèª
            if (!navigator.onLine) {
                alert("ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«æ¥ç¶šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚\næ¥ç¶šã‚’ç¢ºèªã—ã¦ã‹ã‚‰å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
                return;
            }

            preparePrint();

            // 2. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const overlay = document.getElementById('loading-overlay');
            overlay.style.display = 'flex';
            submitted = false;

            // 3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š (15ç§’)
            const timeoutId = setTimeout(() => {
                if (!submitted) {
                    overlay.style.display = 'none';
                    alert("é€ä¿¡ã«å¤±æ•—ã—ãŸå¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼‰ã€‚\né›»æ³¢ã®è‰¯ã„å ´æ‰€ã§å†åº¦ãŠè©¦ã—ã„ãŸã ãã‹ã€ç®¡ç†è€…ã«ã”é€£çµ¡ãã ã•ã„ã€‚");
                }
            }, 15000);

            // éš ã—iframeã®onloadã§æˆåŠŸæ¤œçŸ¥
            const iframe = document.getElementById('hidden_iframe');
            iframe.onload = function () {
                if (submitted) { // äºŒé‡ç™ºç«é˜²æ­¢
                    return;
                }
                clearTimeout(timeoutId);
                submitted = true;
                overlay.style.display = 'none';

                // å°‘ã—å¾…ã£ã¦ã‹ã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆ
                setTimeout(() => {
                    alert('é€ä¿¡å®Œäº†ã—ã¾ã—ãŸï¼å°åˆ·ç”»é¢ã¸é€²ã¿ã¾ã™ã€‚');
                    window.print();
                    // iframeã®onloadãƒªã‚¹ãƒŠãƒ¼ã‚’è§£é™¤ã™ã¹ãã ãŒã€ãƒšãƒ¼ã‚¸ãƒªãƒ­ãƒ¼ãƒ‰ã—ãªã„ãªã‚‰ã“ã®ã¾ã¾ã§ã‚‚è‰¯ã„
                }, 100);
            };

            const rawForm = document.createElement("form");
            rawForm.action = GOOGLE_FORM_ACTION_URL;
            rawForm.method = "POST";
            rawForm.target = "hidden_iframe";
            rawForm.style.display = "none";

            // â˜…ã€Œãã®ä»–ã€ã®è©³ç´°ãƒ†ã‚­ã‚¹ãƒˆã‚’æŠ½å‡ºã—ã¦ã€è©³ç´°åŸå› æ¬„ã«è¿½è¨˜ã™ã‚‹ãƒ­ã‚¸ãƒƒã‚¯
            let otherDetails = [];
            function collectOtherDetails(containerId, labelName) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const checkboxes = container.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    if (cb.checked && cb.value === "ãã®ä»–") {
                        const otherText = cb.parentNode.querySelector('.other-input');
                        if (otherText && otherText.value.trim()) {
                            otherDetails.push(`ã€${labelName}ã®ãã®ä»–ã€‘${otherText.value.trim()}`);
                        }
                    }
                });
            }
            collectOtherDetails('in-type-group', 'ç¨®é¡');
            collectOtherDetails('in-background-group', 'èƒŒæ™¯');
            collectOtherDetails('in-response-group', 'ç›´å¾Œå¯¾å¿œ');
            collectOtherDetails('in-prevention-group', 'é˜²æ­¢ç­–');

            // è©³ç´°åŸå› æ¬„ã«çµåˆ
            let finalDetailedCause = document.getElementById('in-detailed-cause').value;
            if (otherDetails.length > 0) {
                finalDetailedCause += "\n\n" + otherDetails.join("\n");
            }

            const data = {
                [FIELD_MAP.reportDate]: document.getElementById('in-report-date').value,
                [FIELD_MAP.occurrenceDate]: document.getElementById('in-occurrence-date').value.replace('T', ' '),
                [FIELD_MAP.reporter]: document.getElementById('in-reporter').value,
                [FIELD_MAP.place]: document.getElementById('in-place').value,
                [FIELD_MAP.userId]: document.getElementById('in-userid').value,
                [FIELD_MAP.overview]: document.getElementById('in-overview').value,
                [FIELD_MAP.riskLevel]: document.getElementById('in-risk-level').value,
                [FIELD_MAP.frequency]: document.getElementById('in-frequency').value,

                // ã“ã“ã«è¿½è¨˜æ¸ˆã¿ã®è©³ç´°ã‚’å…¥ã‚Œã‚‹
                [FIELD_MAP.detailedCause]: finalDetailedCause,

                [FIELD_MAP.additionalObs]: document.getElementById('in-additional-obs').value,
                [FIELD_MAP.familyExpl]: document.getElementById('in-family-expl').value,
                [FIELD_MAP.incharge]: document.getElementById('in-incharge').value,
                [FIELD_MAP.situation]: document.getElementById('polish-situation').value || document.getElementById('in-situation').value,
            };

            for (const [key, value] of Object.entries(data)) {
                if (key) {
                    const input = document.createElement("input");
                    input.type = "hidden";
                    input.name = key;
                    input.value = value || "";
                    rawForm.appendChild(input);
                }
            }

            // ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹é€ä¿¡ç”¨ï¼ˆå€‹åˆ¥ã«é€ã‚‹ã“ã¨ã§ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹å‹ã«å¯¾å¿œï¼‰
            function appendMultiValuesSafe(fieldId, containerId) {
                const container = document.getElementById(containerId);
                if (!container) return;
                const checkboxes = container.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => {
                    if (cb.checked) {
                        const input = document.createElement("input");
                        input.type = "hidden";
                        input.name = fieldId;
                        // valueã¯ãã®ã¾ã¾é€ã‚‹ï¼ˆãã®ä»–ã‚‚ã€Œãã®ä»–ã€ã¨ã—ã¦é€ã‚‹ï¼‰
                        input.value = cb.value;
                        rawForm.appendChild(input);
                    }
                });
            }

            appendMultiValuesSafe(FIELD_MAP.type, 'in-type-group');
            appendMultiValuesSafe(FIELD_MAP.background, 'in-background-group');
            appendMultiValuesSafe(FIELD_MAP.response, 'in-response-group');
            appendMultiValuesSafe(FIELD_MAP.prevention, 'in-prevention-group');

            document.body.appendChild(rawForm);

            // é€ä¿¡
            rawForm.submit();
            document.body.removeChild(rawForm);
        }
    </script>
</body>

</html>